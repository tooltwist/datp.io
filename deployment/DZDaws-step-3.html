<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Step 3 - Docker image | DATP</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600|Open+Sans:400,600;display=swap" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="icon" href="/datp-images/TooltwistLogo.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/images/icons/apple-icon-152x152.png">
    <script src="https://player.vimeo.com/api/player.js"></script>
    <script src="https://extend.vimeocdn.com/ga/72160148.js" defer="defer"></script>
    <meta name="description" content="DATP - Distributed Aynchronous Transaction Pipelines">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/images/icons/ms-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.1e0e1b88.css" as="style"><link rel="preload" href="/assets/js/app.96c8d89b.js" as="script"><link rel="preload" href="/assets/js/11.9794c269.js" as="script"><link rel="preload" href="/assets/js/85.3ee046ee.js" as="script"><link rel="preload" href="/assets/js/28.ec4f1cef.js" as="script"><link rel="prefetch" href="/assets/js/1.7e95004f.js"><link rel="prefetch" href="/assets/js/100.7b5f279a.js"><link rel="prefetch" href="/assets/js/101.8088a01a.js"><link rel="prefetch" href="/assets/js/102.a2707c46.js"><link rel="prefetch" href="/assets/js/103.610d48ba.js"><link rel="prefetch" href="/assets/js/104.ecbd1190.js"><link rel="prefetch" href="/assets/js/105.900611b7.js"><link rel="prefetch" href="/assets/js/106.5793ab06.js"><link rel="prefetch" href="/assets/js/107.a7fe6820.js"><link rel="prefetch" href="/assets/js/108.a04b80ab.js"><link rel="prefetch" href="/assets/js/109.70f2d20c.js"><link rel="prefetch" href="/assets/js/110.d27acda2.js"><link rel="prefetch" href="/assets/js/111.a718f44b.js"><link rel="prefetch" href="/assets/js/112.4b701799.js"><link rel="prefetch" href="/assets/js/113.a3c2eaab.js"><link rel="prefetch" href="/assets/js/114.560b46bb.js"><link rel="prefetch" href="/assets/js/115.65468bf5.js"><link rel="prefetch" href="/assets/js/116.74778fac.js"><link rel="prefetch" href="/assets/js/117.06524759.js"><link rel="prefetch" href="/assets/js/118.ab6ab93f.js"><link rel="prefetch" href="/assets/js/119.d940e4ad.js"><link rel="prefetch" href="/assets/js/12.181e45a3.js"><link rel="prefetch" href="/assets/js/120.3978c798.js"><link rel="prefetch" href="/assets/js/121.e5dde80c.js"><link rel="prefetch" href="/assets/js/122.f37a9796.js"><link rel="prefetch" href="/assets/js/123.a11365e9.js"><link rel="prefetch" href="/assets/js/124.61342c7f.js"><link rel="prefetch" href="/assets/js/125.f0f1967c.js"><link rel="prefetch" href="/assets/js/126.1356508c.js"><link rel="prefetch" href="/assets/js/127.f16f1b45.js"><link rel="prefetch" href="/assets/js/128.5c2e47ab.js"><link rel="prefetch" href="/assets/js/129.91775d24.js"><link rel="prefetch" href="/assets/js/13.98c968c4.js"><link rel="prefetch" href="/assets/js/130.e45b0936.js"><link rel="prefetch" href="/assets/js/131.c5c07aed.js"><link rel="prefetch" href="/assets/js/132.2ce4c3e9.js"><link rel="prefetch" href="/assets/js/133.7c57901a.js"><link rel="prefetch" href="/assets/js/134.f49b7224.js"><link rel="prefetch" href="/assets/js/135.d5616ac6.js"><link rel="prefetch" href="/assets/js/136.d849ffd6.js"><link rel="prefetch" href="/assets/js/137.b573a6ad.js"><link rel="prefetch" href="/assets/js/138.56258355.js"><link rel="prefetch" href="/assets/js/139.aad4bbf6.js"><link rel="prefetch" href="/assets/js/14.987a7b0c.js"><link rel="prefetch" href="/assets/js/140.189371a6.js"><link rel="prefetch" href="/assets/js/141.495e42d2.js"><link rel="prefetch" href="/assets/js/142.23461167.js"><link rel="prefetch" href="/assets/js/143.121d7dc0.js"><link rel="prefetch" href="/assets/js/144.616bad1a.js"><link rel="prefetch" href="/assets/js/145.a183053d.js"><link rel="prefetch" href="/assets/js/146.81ae4123.js"><link rel="prefetch" href="/assets/js/147.18a05b4c.js"><link rel="prefetch" href="/assets/js/148.1e2e1642.js"><link rel="prefetch" href="/assets/js/149.23793018.js"><link rel="prefetch" href="/assets/js/15.88fd3a8b.js"><link rel="prefetch" href="/assets/js/150.e5ab05fa.js"><link rel="prefetch" href="/assets/js/151.2fde1428.js"><link rel="prefetch" href="/assets/js/152.0d9cd120.js"><link rel="prefetch" href="/assets/js/153.491e5c0e.js"><link rel="prefetch" href="/assets/js/154.8ee1dab7.js"><link rel="prefetch" href="/assets/js/155.102f5e8b.js"><link rel="prefetch" href="/assets/js/156.452ef410.js"><link rel="prefetch" href="/assets/js/157.76bdd568.js"><link rel="prefetch" href="/assets/js/158.7f0db036.js"><link rel="prefetch" href="/assets/js/159.a4a4cf1b.js"><link rel="prefetch" href="/assets/js/16.6090ffcb.js"><link rel="prefetch" href="/assets/js/160.21b43598.js"><link rel="prefetch" href="/assets/js/161.3afc4bd2.js"><link rel="prefetch" href="/assets/js/162.75b81d23.js"><link rel="prefetch" href="/assets/js/163.78d3058f.js"><link rel="prefetch" href="/assets/js/164.6f18bd35.js"><link rel="prefetch" href="/assets/js/165.c58c7885.js"><link rel="prefetch" href="/assets/js/166.9719b94b.js"><link rel="prefetch" href="/assets/js/167.c35776e2.js"><link rel="prefetch" href="/assets/js/168.ff44094f.js"><link rel="prefetch" href="/assets/js/169.97199c11.js"><link rel="prefetch" href="/assets/js/17.16eb2f90.js"><link rel="prefetch" href="/assets/js/170.722e84c7.js"><link rel="prefetch" href="/assets/js/171.50470ebd.js"><link rel="prefetch" href="/assets/js/172.73a0ea3b.js"><link rel="prefetch" href="/assets/js/173.1eda63fb.js"><link rel="prefetch" href="/assets/js/174.83917e43.js"><link rel="prefetch" href="/assets/js/175.e11d5e48.js"><link rel="prefetch" href="/assets/js/176.71d5cc56.js"><link rel="prefetch" href="/assets/js/177.db126c96.js"><link rel="prefetch" href="/assets/js/178.2e5200f4.js"><link rel="prefetch" href="/assets/js/179.2dcffe3c.js"><link rel="prefetch" href="/assets/js/18.5e443404.js"><link rel="prefetch" href="/assets/js/180.3098b79e.js"><link rel="prefetch" href="/assets/js/181.9f4c19e3.js"><link rel="prefetch" href="/assets/js/182.2c581d5e.js"><link rel="prefetch" href="/assets/js/183.19cb9b29.js"><link rel="prefetch" href="/assets/js/184.fc121b8a.js"><link rel="prefetch" href="/assets/js/185.21d5df6a.js"><link rel="prefetch" href="/assets/js/186.02735562.js"><link rel="prefetch" href="/assets/js/187.13b23f74.js"><link rel="prefetch" href="/assets/js/188.871b0a7f.js"><link rel="prefetch" href="/assets/js/189.ad2dbbc4.js"><link rel="prefetch" href="/assets/js/19.3d3fce5f.js"><link rel="prefetch" href="/assets/js/190.8bd38138.js"><link rel="prefetch" href="/assets/js/191.198d8197.js"><link rel="prefetch" href="/assets/js/192.1c597c6a.js"><link rel="prefetch" href="/assets/js/193.63daa1aa.js"><link rel="prefetch" href="/assets/js/194.74ed235d.js"><link rel="prefetch" href="/assets/js/195.c31370fc.js"><link rel="prefetch" href="/assets/js/196.ef493613.js"><link rel="prefetch" href="/assets/js/197.a6842606.js"><link rel="prefetch" href="/assets/js/198.adb638c1.js"><link rel="prefetch" href="/assets/js/199.5774476c.js"><link rel="prefetch" href="/assets/js/2.4c9cebbf.js"><link rel="prefetch" href="/assets/js/20.0e657b3d.js"><link rel="prefetch" href="/assets/js/200.66f0b965.js"><link rel="prefetch" href="/assets/js/201.abf14b35.js"><link rel="prefetch" href="/assets/js/202.468228bd.js"><link rel="prefetch" href="/assets/js/203.63f8186f.js"><link rel="prefetch" href="/assets/js/204.30eff7de.js"><link rel="prefetch" href="/assets/js/205.4035af12.js"><link rel="prefetch" href="/assets/js/206.d03cb4a3.js"><link rel="prefetch" href="/assets/js/207.c8237a70.js"><link rel="prefetch" href="/assets/js/208.ad1fd574.js"><link rel="prefetch" href="/assets/js/209.79847458.js"><link rel="prefetch" href="/assets/js/21.683f305f.js"><link rel="prefetch" href="/assets/js/210.6bff4a9e.js"><link rel="prefetch" href="/assets/js/211.5692485a.js"><link rel="prefetch" href="/assets/js/212.c739d8d9.js"><link rel="prefetch" href="/assets/js/213.9075c716.js"><link rel="prefetch" href="/assets/js/214.9d0406c0.js"><link rel="prefetch" href="/assets/js/215.2d39fe30.js"><link rel="prefetch" href="/assets/js/216.ed9b04a7.js"><link rel="prefetch" href="/assets/js/217.7989eb53.js"><link rel="prefetch" href="/assets/js/218.4459a77c.js"><link rel="prefetch" href="/assets/js/219.66e86f48.js"><link rel="prefetch" href="/assets/js/22.37991c24.js"><link rel="prefetch" href="/assets/js/220.5155a8a3.js"><link rel="prefetch" href="/assets/js/221.21b780fc.js"><link rel="prefetch" href="/assets/js/222.5231eaba.js"><link rel="prefetch" href="/assets/js/223.2bbfe1a6.js"><link rel="prefetch" href="/assets/js/224.902bc25f.js"><link rel="prefetch" href="/assets/js/225.5da79aac.js"><link rel="prefetch" href="/assets/js/226.f0b21230.js"><link rel="prefetch" href="/assets/js/227.63a23441.js"><link rel="prefetch" href="/assets/js/228.18a6770e.js"><link rel="prefetch" href="/assets/js/229.370c71fe.js"><link rel="prefetch" href="/assets/js/23.9601d1cd.js"><link rel="prefetch" href="/assets/js/230.1d37a624.js"><link rel="prefetch" href="/assets/js/231.b0427468.js"><link rel="prefetch" href="/assets/js/232.ddaef15c.js"><link rel="prefetch" href="/assets/js/233.bba6caea.js"><link rel="prefetch" href="/assets/js/234.a944a95a.js"><link rel="prefetch" href="/assets/js/235.ae50fa96.js"><link rel="prefetch" href="/assets/js/236.cfb49c59.js"><link rel="prefetch" href="/assets/js/237.753a9415.js"><link rel="prefetch" href="/assets/js/238.584ff1a5.js"><link rel="prefetch" href="/assets/js/239.a29fadef.js"><link rel="prefetch" href="/assets/js/24.b211565b.js"><link rel="prefetch" href="/assets/js/240.550611c4.js"><link rel="prefetch" href="/assets/js/241.7e23a954.js"><link rel="prefetch" href="/assets/js/242.62b5cfe4.js"><link rel="prefetch" href="/assets/js/243.30d18943.js"><link rel="prefetch" href="/assets/js/244.39cdb125.js"><link rel="prefetch" href="/assets/js/245.f3df432b.js"><link rel="prefetch" href="/assets/js/246.91c235ed.js"><link rel="prefetch" href="/assets/js/247.4058f8b3.js"><link rel="prefetch" href="/assets/js/248.f4c3adf5.js"><link rel="prefetch" href="/assets/js/249.c6dd8c68.js"><link rel="prefetch" href="/assets/js/25.658b9941.js"><link rel="prefetch" href="/assets/js/250.d6d1171c.js"><link rel="prefetch" href="/assets/js/251.925b968f.js"><link rel="prefetch" href="/assets/js/252.55fb900c.js"><link rel="prefetch" href="/assets/js/253.f49fbc2e.js"><link rel="prefetch" href="/assets/js/254.f939f80b.js"><link rel="prefetch" href="/assets/js/255.5f995844.js"><link rel="prefetch" href="/assets/js/256.d80d555c.js"><link rel="prefetch" href="/assets/js/26.a419c574.js"><link rel="prefetch" href="/assets/js/27.ff552d78.js"><link rel="prefetch" href="/assets/js/29.79139b27.js"><link rel="prefetch" href="/assets/js/3.f37bedd0.js"><link rel="prefetch" href="/assets/js/30.d8319f9e.js"><link rel="prefetch" href="/assets/js/31.9a3927f4.js"><link rel="prefetch" href="/assets/js/32.9ea5e497.js"><link rel="prefetch" href="/assets/js/33.a4b51f80.js"><link rel="prefetch" href="/assets/js/34.0744883c.js"><link rel="prefetch" href="/assets/js/35.348d8e95.js"><link rel="prefetch" href="/assets/js/36.ade36d9b.js"><link rel="prefetch" href="/assets/js/37.0bebc7d4.js"><link rel="prefetch" href="/assets/js/38.0a34703a.js"><link rel="prefetch" href="/assets/js/39.67f337d9.js"><link rel="prefetch" href="/assets/js/4.6ac22d55.js"><link rel="prefetch" href="/assets/js/40.d5ff806a.js"><link rel="prefetch" href="/assets/js/41.b1014477.js"><link rel="prefetch" href="/assets/js/42.cb4ff247.js"><link rel="prefetch" href="/assets/js/43.138507eb.js"><link rel="prefetch" href="/assets/js/44.091726f6.js"><link rel="prefetch" href="/assets/js/45.256f0ba1.js"><link rel="prefetch" href="/assets/js/46.57b3a359.js"><link rel="prefetch" href="/assets/js/47.3b6ae717.js"><link rel="prefetch" href="/assets/js/48.15616e68.js"><link rel="prefetch" href="/assets/js/49.db11eeee.js"><link rel="prefetch" href="/assets/js/5.c6098f04.js"><link rel="prefetch" href="/assets/js/50.9527ffd1.js"><link rel="prefetch" href="/assets/js/51.86e32a01.js"><link rel="prefetch" href="/assets/js/52.a708a377.js"><link rel="prefetch" href="/assets/js/53.f79d7c20.js"><link rel="prefetch" href="/assets/js/54.225d4e6f.js"><link rel="prefetch" href="/assets/js/55.695da4fe.js"><link rel="prefetch" href="/assets/js/56.c18e995d.js"><link rel="prefetch" href="/assets/js/57.34e4061f.js"><link rel="prefetch" href="/assets/js/58.6106d582.js"><link rel="prefetch" href="/assets/js/59.9be34dec.js"><link rel="prefetch" href="/assets/js/6.e3a4b8a2.js"><link rel="prefetch" href="/assets/js/60.ee5d5845.js"><link rel="prefetch" href="/assets/js/61.b2ceb24d.js"><link rel="prefetch" href="/assets/js/62.d508c4f9.js"><link rel="prefetch" href="/assets/js/63.e8c67fb5.js"><link rel="prefetch" href="/assets/js/64.b70c27cc.js"><link rel="prefetch" href="/assets/js/65.4c14aa77.js"><link rel="prefetch" href="/assets/js/66.b005fe31.js"><link rel="prefetch" href="/assets/js/67.867f4452.js"><link rel="prefetch" href="/assets/js/68.d180e3b3.js"><link rel="prefetch" href="/assets/js/69.bb7b116b.js"><link rel="prefetch" href="/assets/js/7.c23d6fb5.js"><link rel="prefetch" href="/assets/js/70.f3074e15.js"><link rel="prefetch" href="/assets/js/71.3c493b84.js"><link rel="prefetch" href="/assets/js/72.feac74fd.js"><link rel="prefetch" href="/assets/js/73.9841c07f.js"><link rel="prefetch" href="/assets/js/74.f94b00de.js"><link rel="prefetch" href="/assets/js/75.f4af4ea4.js"><link rel="prefetch" href="/assets/js/76.800063f2.js"><link rel="prefetch" href="/assets/js/77.a8b33c60.js"><link rel="prefetch" href="/assets/js/78.6e9bc75f.js"><link rel="prefetch" href="/assets/js/79.fb661730.js"><link rel="prefetch" href="/assets/js/80.3e8e696b.js"><link rel="prefetch" href="/assets/js/81.e08e2da4.js"><link rel="prefetch" href="/assets/js/82.34d94184.js"><link rel="prefetch" href="/assets/js/83.d13a917a.js"><link rel="prefetch" href="/assets/js/84.09cfc0d9.js"><link rel="prefetch" href="/assets/js/86.48834b04.js"><link rel="prefetch" href="/assets/js/87.51e661d8.js"><link rel="prefetch" href="/assets/js/88.c6bd90f6.js"><link rel="prefetch" href="/assets/js/89.26d6bec6.js"><link rel="prefetch" href="/assets/js/90.253cb7be.js"><link rel="prefetch" href="/assets/js/91.87124049.js"><link rel="prefetch" href="/assets/js/92.85c5685a.js"><link rel="prefetch" href="/assets/js/93.8de279b6.js"><link rel="prefetch" href="/assets/js/94.afd973c9.js"><link rel="prefetch" href="/assets/js/95.00e04899.js"><link rel="prefetch" href="/assets/js/96.eabafd72.js"><link rel="prefetch" href="/assets/js/97.680a8fc8.js"><link rel="prefetch" href="/assets/js/98.ee5a8394.js"><link rel="prefetch" href="/assets/js/99.247a52b0.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.30eb34f0.js"><link rel="prefetch" href="/assets/js/vendors~search-page.b6860559.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1e0e1b88.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><!----> <header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/datp-images/TooltwistLogo.png" alt="DATP" class="logo"> <span class="site-name can-hide">DATP</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/DZDintroduction.html" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/api/DZDDATP.html" class="nav-link">
  API Reference
</a></div><div class="nav-item"><a href="/tutorial/introduction.html" class="nav-link">
  Tutorial
</a></div><div class="nav-item"><a href="/deployment/DZDconfiguration.html" class="nav-link">
  Deployment
</a></div></nav> <div id="docsearch"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/DZDintroduction.html" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/api/DZDDATP.html" class="nav-link">
  API Reference
</a></div><div class="nav-item"><a href="/tutorial/introduction.html" class="nav-link">
  Tutorial
</a></div><div class="nav-item"><a href="/deployment/DZDconfiguration.html" class="nav-link">
  Deployment
</a></div></nav>  <ul class="sidebar-links"><li><a href="/deployment/DZDconfiguration.html" class="sidebar-link">Configuration</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Deploying on AWS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/deployment/DZDaws-introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/deployment/DZDaws-step-1.html" class="sidebar-link">Step 1 - Environment</a></li><li><a href="/deployment/DZDaws-step-2.html" class="sidebar-link">Step 2 - Database</a></li><li><a href="/deployment/DZDaws-step-3.html" aria-current="page" class="active sidebar-link">Step 3 - Docker image</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/deployment/DZDaws-step-3.html#_3-1-the-util-directory" class="sidebar-link">3.1 - The util directory</a></li><li class="sidebar-sub-header"><a href="/deployment/DZDaws-step-3.html#_3-2-docker-build" class="sidebar-link">3.2 - Docker Build</a></li><li class="sidebar-sub-header"><a href="/deployment/DZDaws-step-3.html#_3-3-create-ecr-repository" class="sidebar-link">3.3 - Create ECR Repository</a></li><li class="sidebar-sub-header"><a href="/deployment/DZDaws-step-3.html#_3-4-push-to-ecr-repo" class="sidebar-link">3.4 - Push to ECR repo</a></li><li class="sidebar-sub-header"><a href="/deployment/DZDaws-step-3.html#_3-5-deployment-script-used-later" class="sidebar-link">3.5 - Deployment script (used later)</a></li></ul></li><li><a href="/deployment/DZDaws-step-4.html" class="sidebar-link">Step 4 - Master node</a></li><li><a href="/deployment/DZDaws-step-5.html" class="sidebar-link">Step 5 - Availability Monitor</a></li><li><a href="/deployment/DZDaws-step-6.html" class="sidebar-link">Step 6 - Slave nodes</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="step-3-docker-image"><a href="#step-3-docker-image" class="header-anchor">#</a> Step 3 - Docker image</h1> <p>In this step we build a Docker image for your master server and push it to an AWS repository where it
can be deployed to your various environments.</p> <div class="custom-block tip"><p class="custom-block-title">Note</p> <p><strong>This step only needs to be performed once</strong>, for one environment, and the
resulting ECR repository and Docker image can be used for other environments as well.
By using the same exact same image of your application from development,
testing and staging, through to production, you reduce the possibility of
introducing bugs or incompatible versions of dependancies.</p></div> <h2 id="_3-1-the-util-directory"><a href="#_3-1-the-util-directory" class="header-anchor">#</a> 3.1 - The util directory</h2> <p>The <code>util</code> directory in the project folder provides scripts to build a Docker image for your DATP application.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Project Directory
├─ DATP
├─ MONDAT
├─ etc
└─ util
  ├─ 1.build-on-docker
  ├─ 2.push-to-ecr
  ├─ 3.deploy-to-XXX
  ├─ start-on-docker
  ├─ Config
  ├─ Dockerfile
  └─ etc
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>These scripts will require tweaking for your environment.</p> <p>A prerequisite for running these scripts is that you have the <strong>AWS CLI</strong> installed.
In some scripts you will see <code>AWS_PROFILE</code> specified. This must have a corresponding entry in your <code>~/.aws/credentials</code> file. For more
information see the AWS CLI documentation.</p> <p>The numbered scripts can be run in order to perform a normal deployment, however if you are still setting things up
you might want to test a few things along the way... After running</p> <h2 id="_3-2-docker-build"><a href="#_3-2-docker-build" class="header-anchor">#</a> 3.2 - Docker Build</h2> <p>This script runs a <code>docker build</code> to create the image of your application, based on the Dockerfile also in the util directory.</p> <div class="language- extra-class"><pre><code>./1.build-on-docker
</code></pre></div><p>To ensure consistency between the desktop development environment and the application deployed on AWS, this Dockerfile should be
similar to <code>~/vscode/Dockerfile.ubuntu</code> excluding however any entries in that file that just support Visual Studio Code.</p> <p>Once the image is built sucessfully, you can use test the image on your local machine.</p> <div class="language- extra-class"><pre><code>./start-on-docker
</code></pre></div><p>The docker options provided by the script should allow the container to connect to the same database that is running when you
are using Visual Studio Code to develop the application. You will need to create a config file <code>util/Config/config-for-juice-yourName-DOCKER.json</code>,
and copying the example config file in the same directory usually works fine.</p> <p>Once the container is running, the <code>docker ps</code> command will show you the ports you can use to attach to the application.</p> <h2 id="_3-3-create-ecr-repository"><a href="#_3-3-create-ecr-repository" class="header-anchor">#</a> 3.3 - Create ECR Repository</h2> <p>Amazon ECR (Elastic Container Repository) is a repository for your Docker images.</p> <p>There will be <strong>one</strong> ECR repository for each project, irrespective of how many environments you deploy it to. The name of the repository should generally be the name of the project's repository in Github with a hyphen to replace the slash. For example, for <code>tooltwist/acme</code> you would create an ECR repository named <code>tooltwist-acme</code>.</p> <h4 id="template"><a href="#template" class="header-anchor">#</a> Template</h4> <p><code>https://s3-ap-southeast-1.amazonaws.com/tooltwist.aws-explorer.templates.2020-09-02/21.project-ecr-image-repo.cf</code></p> <p><code>2021-11-06/21.project-ecr-image-repo.cf</code></p> <h4 id="fields"><a href="#fields" class="header-anchor">#</a> Fields</h4> <table><thead><tr><th>Field</th> <th>Description</th></tr></thead> <tbody><tr><td>Stack Name</td> <td>ecr-repositoryname  (e.g. 'ecr-tooltwist-acme')</td></tr> <tr><td>Docker image repository</td> <td>Repository name (e.g. tooltwist-acme)</td></tr></tbody></table> <p>Once the repository is created, go to your <a href="https://ap-southeast-1.console.aws.amazon.com/ecr/repositories?region=ap-southeast-1" target="_blank" rel="noopener noreferrer">ECR Dashboard<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and select the new repository to see the details of the repository.</p> <h2 id="_3-4-push-to-ecr-repo"><a href="#_3-4-push-to-ecr-repo" class="header-anchor">#</a> 3.4 - Push to ECR repo</h2> <div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p>Before running this script check that constant values provided at the top, that define
your AWS account, repository name, etc, are correct.</p></div> <div class="language- extra-class"><pre><code>./2.push-to-ecr
</code></pre></div><p>This command chooses a version number based upon the current date and time, and pushes the image up to your AWS ECR repository. When it finishes it displays a message containing the version number.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>...
0a1c0b220d6e: Layer already exists
de1bb73bcb8b: Layer already exists
0279b13c6fc6: Layer already exists
2021-11-11.1533: digest: sha256:349011842dc903b82c5acfbc7353dc35b08c60a8b25514a4aa76e1000f6ea748 size: 8255
Push 2021-11-11.1533 complete.

New tag is 2021-11-11.1533

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Take note of that tag / version number - you will need it to deploy the correct image into your envionment(s).</p> <h2 id="_3-5-deployment-script-used-later"><a href="#_3-5-deployment-script-used-later" class="header-anchor">#</a> 3.5 - Deployment script (used later)</h2> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>This script deploys the image you pushed to the ECR repository into an <em><strong>existing</strong></em> service.
We mention it here because we've discussed the other scripts, but you will not be able to run it
until you've completed the next step (Step 4 - Master node).</p> <p>However, feel free to use this command later!</p></div> <p>You will often have multiple versions of this script, so you can deploy to your dev, test, staging environments.
You normally will not have a script for production, as you don't want developers doing production deployments.</p> <p>The first parameter of this command will be the version number displayed by the previous step.</p> <div class="custom-block danger"><p class="custom-block-title">Super important !!!</p> <p>Make sure you provide an existing, valid, version number. If you mistype this the server deployment will hang,
and you'll have to either cancel the update from the AWS console, or wait about half an hour for it to time out.</p></div> <div class="language- extra-class"><pre><code>./3.deploy-to-dev 2011-10-04.1254
</code></pre></div><p>This command will give you two options for following the status of the deployment. The first is a command you
can run using the AWS CLI, while the second is a link to the AWS Console.</p> <p>This deployment works by performing an update of the version parameter supplied to the Cloudformation script
that provisions the service (in step 4 ahead). If you have any problems or need to debug this deployment,
take a look at the following likely hotspots:</p> <ul><li>Cloudformation console</li> <li>The ECS task deployment, specifically the log entries for stopped (failed) tasks.</li> <li>The Target group for the task.</li> <li>The application security group for the environment.</li></ul> <p>For more information refer to the AWS documentation, and AWS expert, or Aunty Google.</p></div> <footer class="page-edit" data-v-656dfe6a><div class="container" data-v-656dfe6a><p data-v-656dfe6a>
      Deployed on
      <a href="https://pages.github.com/" data-v-656dfe6a>Github Pages</a>.
       <br data-v-656dfe6a> <span class="prefix" data-v-656dfe6a>Last updated:</span> <span class="time" data-v-656dfe6a>2022-07-13, 05:12:23 UTC</span></p></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/deployment/DZDaws-step-2.html" class="prev">Step 2 - Database</a></span> <span class="next"><a href="/deployment/DZDaws-step-4.html">Step 4 - Master node</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.96c8d89b.js" defer></script><script src="/assets/js/11.9794c269.js" defer></script><script src="/assets/js/85.3ee046ee.js" defer></script><script src="/assets/js/28.ec4f1cef.js" defer></script>
  </body>
</html>
