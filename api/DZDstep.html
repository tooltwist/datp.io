<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>class Step | DATP</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600|Open+Sans:400,600;display=swap" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="icon" href="/datp-images/TooltwistLogo.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/images/icons/apple-icon-152x152.png">
    <script src="https://player.vimeo.com/api/player.js"></script>
    <script src="https://extend.vimeocdn.com/ga/72160148.js" defer="defer"></script>
    <meta name="description" content="DATP - Distributed Aynchronous Transaction Pipelines">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/images/icons/ms-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.eae15721.css" as="style"><link rel="preload" href="/assets/js/app.33c9f4d6.js" as="script"><link rel="preload" href="/assets/js/11.9794c269.js" as="script"><link rel="preload" href="/assets/js/56.c18e995d.js" as="script"><link rel="preload" href="/assets/js/28.ec4f1cef.js" as="script"><link rel="prefetch" href="/assets/js/1.7e95004f.js"><link rel="prefetch" href="/assets/js/100.7bcab67f.js"><link rel="prefetch" href="/assets/js/101.eb33c8bd.js"><link rel="prefetch" href="/assets/js/102.185d6f57.js"><link rel="prefetch" href="/assets/js/103.4a7eae43.js"><link rel="prefetch" href="/assets/js/104.ecbd1190.js"><link rel="prefetch" href="/assets/js/105.c1315793.js"><link rel="prefetch" href="/assets/js/106.5c4ef240.js"><link rel="prefetch" href="/assets/js/107.76991de8.js"><link rel="prefetch" href="/assets/js/108.78a76910.js"><link rel="prefetch" href="/assets/js/109.64580bcd.js"><link rel="prefetch" href="/assets/js/110.e37db154.js"><link rel="prefetch" href="/assets/js/111.8a1c8b0c.js"><link rel="prefetch" href="/assets/js/112.cca31b84.js"><link rel="prefetch" href="/assets/js/113.ba183e9c.js"><link rel="prefetch" href="/assets/js/114.4870eef9.js"><link rel="prefetch" href="/assets/js/115.9c17e8ea.js"><link rel="prefetch" href="/assets/js/116.b1329bae.js"><link rel="prefetch" href="/assets/js/117.28471944.js"><link rel="prefetch" href="/assets/js/118.db2bf54f.js"><link rel="prefetch" href="/assets/js/119.e13dd12f.js"><link rel="prefetch" href="/assets/js/12.181e45a3.js"><link rel="prefetch" href="/assets/js/120.ecd33a39.js"><link rel="prefetch" href="/assets/js/121.0226df03.js"><link rel="prefetch" href="/assets/js/122.84b63591.js"><link rel="prefetch" href="/assets/js/123.a11365e9.js"><link rel="prefetch" href="/assets/js/124.245d443f.js"><link rel="prefetch" href="/assets/js/125.b53725c3.js"><link rel="prefetch" href="/assets/js/126.bf52b454.js"><link rel="prefetch" href="/assets/js/127.738a02ab.js"><link rel="prefetch" href="/assets/js/128.5c2e47ab.js"><link rel="prefetch" href="/assets/js/129.91775d24.js"><link rel="prefetch" href="/assets/js/13.dbc10f41.js"><link rel="prefetch" href="/assets/js/130.1153b934.js"><link rel="prefetch" href="/assets/js/131.611ca10e.js"><link rel="prefetch" href="/assets/js/132.38efc7fd.js"><link rel="prefetch" href="/assets/js/133.0561ab2d.js"><link rel="prefetch" href="/assets/js/134.f49b7224.js"><link rel="prefetch" href="/assets/js/135.697864e1.js"><link rel="prefetch" href="/assets/js/136.f98a4bdb.js"><link rel="prefetch" href="/assets/js/137.e91ba0ec.js"><link rel="prefetch" href="/assets/js/138.e0b97f91.js"><link rel="prefetch" href="/assets/js/139.dcefea48.js"><link rel="prefetch" href="/assets/js/14.2c3907f1.js"><link rel="prefetch" href="/assets/js/140.0089d373.js"><link rel="prefetch" href="/assets/js/141.495e42d2.js"><link rel="prefetch" href="/assets/js/142.9988e0fa.js"><link rel="prefetch" href="/assets/js/143.258528d3.js"><link rel="prefetch" href="/assets/js/144.616bad1a.js"><link rel="prefetch" href="/assets/js/145.8a4d2039.js"><link rel="prefetch" href="/assets/js/146.055b73c8.js"><link rel="prefetch" href="/assets/js/147.18a05b4c.js"><link rel="prefetch" href="/assets/js/148.95d2861d.js"><link rel="prefetch" href="/assets/js/149.23793018.js"><link rel="prefetch" href="/assets/js/15.5503fbd3.js"><link rel="prefetch" href="/assets/js/150.d2eb808e.js"><link rel="prefetch" href="/assets/js/151.7ee45428.js"><link rel="prefetch" href="/assets/js/152.d4214553.js"><link rel="prefetch" href="/assets/js/153.663a76b4.js"><link rel="prefetch" href="/assets/js/154.8ee1dab7.js"><link rel="prefetch" href="/assets/js/155.74ee62eb.js"><link rel="prefetch" href="/assets/js/156.61358d57.js"><link rel="prefetch" href="/assets/js/157.d9db29c5.js"><link rel="prefetch" href="/assets/js/158.9ec6b86a.js"><link rel="prefetch" href="/assets/js/159.ac003512.js"><link rel="prefetch" href="/assets/js/16.4a69fc06.js"><link rel="prefetch" href="/assets/js/160.abb35155.js"><link rel="prefetch" href="/assets/js/161.75e4a9f7.js"><link rel="prefetch" href="/assets/js/162.a99d3e61.js"><link rel="prefetch" href="/assets/js/163.717ca18b.js"><link rel="prefetch" href="/assets/js/164.6f18bd35.js"><link rel="prefetch" href="/assets/js/165.13d4a65e.js"><link rel="prefetch" href="/assets/js/166.9719b94b.js"><link rel="prefetch" href="/assets/js/167.575d3766.js"><link rel="prefetch" href="/assets/js/168.af049154.js"><link rel="prefetch" href="/assets/js/169.a039b994.js"><link rel="prefetch" href="/assets/js/17.16eb2f90.js"><link rel="prefetch" href="/assets/js/170.cb123520.js"><link rel="prefetch" href="/assets/js/171.241b85a5.js"><link rel="prefetch" href="/assets/js/172.5c7f942e.js"><link rel="prefetch" href="/assets/js/173.595c3aaa.js"><link rel="prefetch" href="/assets/js/174.426ee699.js"><link rel="prefetch" href="/assets/js/175.ff4477cb.js"><link rel="prefetch" href="/assets/js/176.0d3ce14b.js"><link rel="prefetch" href="/assets/js/177.59596e30.js"><link rel="prefetch" href="/assets/js/178.1f1901c9.js"><link rel="prefetch" href="/assets/js/179.e6486222.js"><link rel="prefetch" href="/assets/js/18.5e443404.js"><link rel="prefetch" href="/assets/js/180.3098b79e.js"><link rel="prefetch" href="/assets/js/181.ff74bde4.js"><link rel="prefetch" href="/assets/js/182.2c581d5e.js"><link rel="prefetch" href="/assets/js/183.d714f92e.js"><link rel="prefetch" href="/assets/js/184.7f3b7958.js"><link rel="prefetch" href="/assets/js/185.80f62ec4.js"><link rel="prefetch" href="/assets/js/186.b4a3923b.js"><link rel="prefetch" href="/assets/js/187.7e7c0534.js"><link rel="prefetch" href="/assets/js/188.871b0a7f.js"><link rel="prefetch" href="/assets/js/189.c61757c8.js"><link rel="prefetch" href="/assets/js/19.3d3fce5f.js"><link rel="prefetch" href="/assets/js/190.54e71055.js"><link rel="prefetch" href="/assets/js/191.198d8197.js"><link rel="prefetch" href="/assets/js/192.c0776953.js"><link rel="prefetch" href="/assets/js/193.fc05ed7c.js"><link rel="prefetch" href="/assets/js/194.fce47f94.js"><link rel="prefetch" href="/assets/js/195.c31370fc.js"><link rel="prefetch" href="/assets/js/196.61772844.js"><link rel="prefetch" href="/assets/js/197.a6842606.js"><link rel="prefetch" href="/assets/js/198.adb638c1.js"><link rel="prefetch" href="/assets/js/199.48d903cf.js"><link rel="prefetch" href="/assets/js/2.ea760195.js"><link rel="prefetch" href="/assets/js/20.0e657b3d.js"><link rel="prefetch" href="/assets/js/200.60496ca3.js"><link rel="prefetch" href="/assets/js/201.abf14b35.js"><link rel="prefetch" href="/assets/js/202.16494de1.js"><link rel="prefetch" href="/assets/js/203.63f8186f.js"><link rel="prefetch" href="/assets/js/204.0746da1e.js"><link rel="prefetch" href="/assets/js/205.d5789643.js"><link rel="prefetch" href="/assets/js/206.9d6af83f.js"><link rel="prefetch" href="/assets/js/207.c0df2397.js"><link rel="prefetch" href="/assets/js/208.ec8c8928.js"><link rel="prefetch" href="/assets/js/209.79847458.js"><link rel="prefetch" href="/assets/js/21.683f305f.js"><link rel="prefetch" href="/assets/js/210.3a9483d4.js"><link rel="prefetch" href="/assets/js/211.5692485a.js"><link rel="prefetch" href="/assets/js/212.166a86a3.js"><link rel="prefetch" href="/assets/js/213.9075c716.js"><link rel="prefetch" href="/assets/js/214.f3d4f649.js"><link rel="prefetch" href="/assets/js/215.2d39fe30.js"><link rel="prefetch" href="/assets/js/216.295e5156.js"><link rel="prefetch" href="/assets/js/217.57688dd8.js"><link rel="prefetch" href="/assets/js/218.75dca5b3.js"><link rel="prefetch" href="/assets/js/219.66e86f48.js"><link rel="prefetch" href="/assets/js/22.63826dca.js"><link rel="prefetch" href="/assets/js/220.e0733238.js"><link rel="prefetch" href="/assets/js/221.6cc54d33.js"><link rel="prefetch" href="/assets/js/222.becbddf7.js"><link rel="prefetch" href="/assets/js/223.2bbfe1a6.js"><link rel="prefetch" href="/assets/js/224.48ab02a5.js"><link rel="prefetch" href="/assets/js/225.3d5fcbfc.js"><link rel="prefetch" href="/assets/js/226.f0b21230.js"><link rel="prefetch" href="/assets/js/227.18e3b4d3.js"><link rel="prefetch" href="/assets/js/228.5e72a2ab.js"><link rel="prefetch" href="/assets/js/23.9601d1cd.js"><link rel="prefetch" href="/assets/js/24.c2eb79c1.js"><link rel="prefetch" href="/assets/js/25.658b9941.js"><link rel="prefetch" href="/assets/js/26.4b6921a9.js"><link rel="prefetch" href="/assets/js/27.a8c565fb.js"><link rel="prefetch" href="/assets/js/29.79139b27.js"><link rel="prefetch" href="/assets/js/3.53782fd9.js"><link rel="prefetch" href="/assets/js/30.d8319f9e.js"><link rel="prefetch" href="/assets/js/31.9a3927f4.js"><link rel="prefetch" href="/assets/js/32.9ea5e497.js"><link rel="prefetch" href="/assets/js/33.40c4cb9b.js"><link rel="prefetch" href="/assets/js/34.4856049d.js"><link rel="prefetch" href="/assets/js/35.348d8e95.js"><link rel="prefetch" href="/assets/js/36.ade36d9b.js"><link rel="prefetch" href="/assets/js/37.b69be42d.js"><link rel="prefetch" href="/assets/js/38.7ad2d08c.js"><link rel="prefetch" href="/assets/js/39.67f337d9.js"><link rel="prefetch" href="/assets/js/4.2c7b0d3b.js"><link rel="prefetch" href="/assets/js/40.730a7fbe.js"><link rel="prefetch" href="/assets/js/41.a6d5ba63.js"><link rel="prefetch" href="/assets/js/42.08822d53.js"><link rel="prefetch" href="/assets/js/43.138507eb.js"><link rel="prefetch" href="/assets/js/44.091726f6.js"><link rel="prefetch" href="/assets/js/45.ae398c8a.js"><link rel="prefetch" href="/assets/js/46.1e4bc650.js"><link rel="prefetch" href="/assets/js/47.3b6ae717.js"><link rel="prefetch" href="/assets/js/48.c765f341.js"><link rel="prefetch" href="/assets/js/49.db11eeee.js"><link rel="prefetch" href="/assets/js/5.6e5cc9cb.js"><link rel="prefetch" href="/assets/js/50.5f96996c.js"><link rel="prefetch" href="/assets/js/51.86e32a01.js"><link rel="prefetch" href="/assets/js/52.a708a377.js"><link rel="prefetch" href="/assets/js/53.1760bc42.js"><link rel="prefetch" href="/assets/js/54.931bb1a8.js"><link rel="prefetch" href="/assets/js/55.b663b9b8.js"><link rel="prefetch" href="/assets/js/57.34e4061f.js"><link rel="prefetch" href="/assets/js/58.d4421766.js"><link rel="prefetch" href="/assets/js/59.8d276d22.js"><link rel="prefetch" href="/assets/js/6.e3a4b8a2.js"><link rel="prefetch" href="/assets/js/60.ee5d5845.js"><link rel="prefetch" href="/assets/js/61.e471650d.js"><link rel="prefetch" href="/assets/js/62.d508c4f9.js"><link rel="prefetch" href="/assets/js/63.e8c67fb5.js"><link rel="prefetch" href="/assets/js/64.b70c27cc.js"><link rel="prefetch" href="/assets/js/65.b8a86ea8.js"><link rel="prefetch" href="/assets/js/66.ba9dd74a.js"><link rel="prefetch" href="/assets/js/67.8e3105d4.js"><link rel="prefetch" href="/assets/js/68.80cba77e.js"><link rel="prefetch" href="/assets/js/69.553a25af.js"><link rel="prefetch" href="/assets/js/7.8953f970.js"><link rel="prefetch" href="/assets/js/70.f3074e15.js"><link rel="prefetch" href="/assets/js/71.32bd5d6b.js"><link rel="prefetch" href="/assets/js/72.c9e3eeb7.js"><link rel="prefetch" href="/assets/js/73.3cd67d14.js"><link rel="prefetch" href="/assets/js/74.1deb15d4.js"><link rel="prefetch" href="/assets/js/75.3dd79bd7.js"><link rel="prefetch" href="/assets/js/76.cf1b1a43.js"><link rel="prefetch" href="/assets/js/77.296cd543.js"><link rel="prefetch" href="/assets/js/78.34d802e6.js"><link rel="prefetch" href="/assets/js/79.ae9efa47.js"><link rel="prefetch" href="/assets/js/80.a0eade59.js"><link rel="prefetch" href="/assets/js/81.d7f2c802.js"><link rel="prefetch" href="/assets/js/82.86823f81.js"><link rel="prefetch" href="/assets/js/83.d13a917a.js"><link rel="prefetch" href="/assets/js/84.27de6ccd.js"><link rel="prefetch" href="/assets/js/85.3ee046ee.js"><link rel="prefetch" href="/assets/js/86.41dbc2c6.js"><link rel="prefetch" href="/assets/js/87.9a1712eb.js"><link rel="prefetch" href="/assets/js/88.cdf17327.js"><link rel="prefetch" href="/assets/js/89.26d6bec6.js"><link rel="prefetch" href="/assets/js/90.9b3c40ed.js"><link rel="prefetch" href="/assets/js/91.4d917d37.js"><link rel="prefetch" href="/assets/js/92.e2d86387.js"><link rel="prefetch" href="/assets/js/93.2fcd06de.js"><link rel="prefetch" href="/assets/js/94.afd973c9.js"><link rel="prefetch" href="/assets/js/95.4a246582.js"><link rel="prefetch" href="/assets/js/96.04169f47.js"><link rel="prefetch" href="/assets/js/97.fbd5cdc5.js"><link rel="prefetch" href="/assets/js/98.4260400a.js"><link rel="prefetch" href="/assets/js/99.febbe420.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.30eb34f0.js"><link rel="prefetch" href="/assets/js/vendors~search-page.b6860559.js">
    <link rel="stylesheet" href="/assets/css/0.styles.eae15721.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><!----> <header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/datp-images/TooltwistLogo.png" alt="DATP" class="logo"> <span class="site-name can-hide">DATP</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/DZDintroduction.html" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/api/DZDDATP.html" class="nav-link">
  API Reference
</a></div><div class="nav-item"><a href="/deployment/DZDconfiguration.html" class="nav-link">
  Deployment
</a></div></nav> <div id="docsearch"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/DZDintroduction.html" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/api/DZDDATP.html" class="nav-link">
  API Reference
</a></div><div class="nav-item"><a href="/deployment/DZDconfiguration.html" class="nav-link">
  Deployment
</a></div></nav>  <ul class="sidebar-links"><li><a href="/api/DZDDATP.html" class="sidebar-link">DATP package</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Classes</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/api/DZDstepInstance.html" class="sidebar-link">class StepInstance</a></li><li><a href="/api/DZDstep.html" aria-current="page" class="active sidebar-link">class Step</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/DZDstep.html#constructor" class="sidebar-link">constructor</a></li><li class="sidebar-sub-header"><a href="/api/DZDstep.html#invoke" class="sidebar-link">invoke</a></li><li class="sidebar-sub-header"><a href="/api/DZDstep.html#rollback" class="sidebar-link">rollback</a></li><li class="sidebar-sub-header"><a href="/api/DZDstep.html#register" class="sidebar-link">register</a></li><li class="sidebar-sub-header"><a href="/api/DZDstep.html#factory" class="sidebar-link">factory</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Variables</span> <!----></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Other</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/api/DZDDATPextras.html" class="sidebar-link">DATP/extras</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="class-step"><a href="#class-step" class="header-anchor">#</a> class Step</h1> <p>As you customize your DATP application, you implement new steps by
defining a class that overrides the <code>Step</code> object.</p> <p>Your class represents a <em>type</em> of step, not an actual <em>instance</em> of a step
being run in a pipeline. At the time your <code>invoke</code> and <code>rollback</code> functions are
called, they will be provided an <code>instance</code> parameter that represents the
specific step <em>instance</em> for which the function is being run.</p> <p>The following is an example of a javascript module that implements a step.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">ExampleStep</span> <span class="token keyword">extends</span> <span class="token class-name">Step</span> <span class="token punctuation">{</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">definition</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>definition<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>someValue <span class="token operator">=</span> definition<span class="token punctuation">.</span>someValue
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * This function is called to run this step. The step instance parameter
   * provides the context of the transaction and also convenience functions.
   * @param {StepInstance} instance
   */</span>
  <span class="token keyword">async</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * This function is called to undo whatever was previously done by the invoke function. * The step instance parameter provides the context of the transaction and also
   * the convenience functions.
   * If a rollback is not possible, or no rollback is required do not implement this
   * function. If an error occurs during a rollback,
   * @param {StepInstance} instance
   */</span>
  <span class="token keyword">async</span> <span class="token function">rollback</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * This function is called to register this as an available step type.
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> StepTypes<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>myDef<span class="token punctuation">,</span> <span class="token string">'example/exampleStep'</span><span class="token punctuation">,</span> <span class="token string">'Example step'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token comment">//- register</span>


<span class="token comment">/**
 *
 * @param {Object} definition Object created from the JSON definition of the step in the pipeline.
 * @returns New step instance
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token parameter">definition</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> rec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExampleStep</span><span class="token punctuation">(</span>definition<span class="token punctuation">)</span>
  <span class="token keyword">return</span> rec
<span class="token punctuation">}</span><span class="token comment">//- factory</span>


<span class="token keyword">const</span> myDef <span class="token operator">=</span> <span class="token punctuation">{</span>
  register<span class="token punctuation">,</span>
  factory<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> myDef
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><p>Note that there are two functions external to the class that are returned by the
Javascript module.</p> <ul><li>The <code>register</code> function, which will be called by your application statup code
to register this step type. It can then be used in pipelines.</li> <li>The <code>factory</code> function, used by DATP to instantiate your step's class when it
is required by a pipeline. Note that the pipeline passes a definition to this
factory, so not all instances of this step type will be the same. You
can write your step to perform however you like, based upon the definition
it receives.</li></ul> <h2 id="constructor"><a href="#constructor" class="header-anchor">#</a> constructor</h2> <ul><li><p><strong>Arguments:</strong></p> <ul><li><code>{object} definition</code></li></ul></li> <li><p><strong>Usage:</strong></p> <p>This is a standard class constructor. The <code>definition</code> parameter comes from the
JSON definition for the step, in the pipeline definition. As mentioned above, it
is entirely up to you what the definition should contain, and what your step will
do with that definition.</p> <p>The constructor must first pass the definition to the constructor of the
Step superclass, using <code>super(definition)</code>. Once that is done it should store
away any values in the definition that will be used by the <code>invoke</code> and <code>rollback</code>
functions.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>We recommend using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/Private_class_fields" target="_blank" rel="noopener noreferrer">private class variables<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, which from ES16 are variables prefixed with a hash.</p></div></li> <li><p><strong>Example:</strong></p></li></ul> <p>The definition in the pipeline:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  message<span class="token operator">:</span> 'Good morning'<span class="token punctuation">,</span>
  amount<span class="token operator">:</span> <span class="token number">123.45</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>The constructor in your step class:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> Step <span class="token keyword">from</span> <span class="token string">&quot;../Step&quot;</span>
<span class="token keyword">import</span> StepTypes <span class="token keyword">from</span> <span class="token string">'../StepTypeRegister'</span>

<span class="token keyword">class</span> <span class="token class-name">MyFavoriteStep</span> <span class="token keyword">extends</span> <span class="token class-name">Step</span> <span class="token punctuation">{</span>
  #message
  #amount

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">definition</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>definition<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#message <span class="token operator">=</span> definition<span class="token punctuation">.</span>message
    <span class="token keyword">this</span><span class="token punctuation">.</span>#amount <span class="token operator">=</span> definition<span class="token punctuation">.</span>amount
  <span class="token punctuation">}</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li><strong>See also:</strong> <a href="/guide/component-basics.html">Components</a></li></ul> <h2 id="invoke"><a href="#invoke" class="header-anchor">#</a> invoke</h2> <ul><li><p><strong>Arguments:</strong></p> <ul><li><code>{StepInstance} instance</code> Details of the step instance being run</li></ul></li> <li><p><strong>Usage:</strong></p></li></ul> <p>The <code>invoke</code> function performs that actual functionality of the step. The
instance parameter provides the context of the transaction and also
convenience functions.</p> <ul><li><strong>Example:</strong></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">async</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Write something to the transaction logbook</span>
    <span class="token keyword">const</span> stepId <span class="token operator">=</span> instance<span class="token punctuation">.</span><span class="token function">getStepId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    instance<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">MyFavoriteStep invoked [</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stepId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

    <span class="token comment">// Get the data input to the step</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> instance<span class="token punctuation">.</span><span class="token function">getDataAsObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// Do something, using the data and details from the definition</span>
    <span class="token keyword">const</span> greeting <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#message
    data<span class="token punctuation">.</span>newMessage <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>greeting<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>firstName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>

    <span class="token comment">// Add credit to an account</span>
    instance<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Crediting </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>#amount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> to account </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>accountNo<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">creditAccount</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>accountNo<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#amount<span class="token punctuation">)</span>

    <span class="token comment">// Time to complete the step and send a result</span>
    <span class="token keyword">const</span> note <span class="token operator">=</span> <span class="token string">''</span>
    instance<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">MyFavoriteStep complete [</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stepId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> instance<span class="token punctuation">.</span><span class="token function">succeeded</span><span class="token punctuation">(</span>note<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><ul><li><strong>See also:</strong> <a href="/api/DZDstepInstance.html">Application Config</a></li></ul> <h2 id="rollback"><a href="#rollback" class="header-anchor">#</a> rollback</h2> <ul><li><strong>Usage:</strong></li></ul> <p>The <code>rollback</code> function needs to undo any significant changes made when
invoke was called. It gets called if a step further down the pipeline from this
step fails, requiring that DATP back out every step that has already completed.</p> <p>The instance parameter provides the context of the transaction and also
convenience functions.</p> <ul><li><strong>Example:</strong></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">async</span> <span class="token function">rollback</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Write something to the transaction logbook</span>
    <span class="token keyword">const</span> stepId <span class="token operator">=</span> instance<span class="token punctuation">.</span><span class="token function">getStepid</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    instance<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">MyFavoriteStep rolling back [</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stepId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

    <span class="token comment">// Get the data input to the step</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> instance<span class="token punctuation">.</span><span class="token function">getDataAsObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// Remove the credit added to the account during 'invoke'</span>
    instance<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Reversing credit of </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>#amount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> to account </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>accountNo<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">creditAccount</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>accountNo<span class="token punctuation">,</span>  <span class="token operator">-</span>data<span class="token punctuation">.</span>amount<span class="token punctuation">)</span>

    <span class="token comment">// Finish up</span>
    instance<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">MyFavoriteStep roll back complete [</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stepId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> note <span class="token operator">=</span> <span class="token string">'...'</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> instance<span class="token punctuation">.</span><span class="token function">rolledBack</span><span class="token punctuation">(</span>note<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ul><li><strong>See also:</strong> <a href="/api/DZDstepInstance.html">Application Config</a></li></ul> <h2 id="register"><a href="#register" class="header-anchor">#</a> register</h2> <ul><li><p><strong>Returns:</strong></p> <ul><li><code>{Promise&lt;void&gt;}</code></li></ul></li> <li><p><strong>Usage:</strong></p> <p>You provide a <code>register</code> function that registers your step class with DATP.</p> <p>Then, in your application startup code you call the registration function to make
your custom step type available to pipelines.</p> <blockquote><p>Note that this function is not a class function. It is a function exported by your
Javascript module, that will be called by you in your server startup code.</p></blockquote></li> <li><p><strong>Example:</strong></p></li></ul> <p>MyFavoriteStep.js:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">MyFavoriteStep</span> <span class="token keyword">extends</span> <span class="token class-name">Step</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> StepTypes<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>myDef<span class="token punctuation">,</span> <span class="token string">'me/myStep'</span><span class="token punctuation">,</span> <span class="token string">'My favorite step'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token comment">//- register</span>

<span class="token keyword">const</span> myDef <span class="token operator">=</span> <span class="token punctuation">{</span>
  register<span class="token punctuation">,</span>
  factory<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> myDef
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>app.js:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> MyFavoriteStep <span class="token keyword">from</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">steps/MyFavoriteStep</span><span class="token template-punctuation string">`</span></span>
<span class="token operator">...</span>

<span class="token keyword">await</span> MyStep<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="factory"><a href="#factory" class="header-anchor">#</a> factory</h2> <ul><li><p><strong>Arguments:</strong></p> <ul><li><code>{Object} definition</code> An object representation of the JSON data defining
this step in the pipeline definition.</li></ul></li> <li><p><strong>Returns:</strong></p> <ul><li><code>{Promise&lt;void&gt;}</code></li></ul></li> <li><p><strong>Usage:</strong></p> <p>Your factory function instantiates and returns your step class.</p> <blockquote><p>Note that this function is not a class function. It is a function exported by your
Javascript module, that will be called by you in your server startup code.</p></blockquote></li> <li><p><strong>Example:</strong></p></li></ul> <p>MyStep.js:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token parameter">definition</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyFavoriteStep</span><span class="token punctuation">(</span>definition<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div> <footer class="page-edit" data-v-656dfe6a><div class="container" data-v-656dfe6a><p data-v-656dfe6a>
      Deployed on
      <a href="https://pages.github.com/" data-v-656dfe6a>Github Pages</a>.
       <br data-v-656dfe6a> <span class="prefix" data-v-656dfe6a>Last updated:</span> <span class="time" data-v-656dfe6a>2022-07-13, 05:12:23 UTC</span></p></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/api/DZDstepInstance.html" class="prev">class StepInstance</a></span> <span class="next"><a href="/api/DZDDATPextras.html">DATP/extras</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.33c9f4d6.js" defer></script><script src="/assets/js/11.9794c269.js" defer></script><script src="/assets/js/56.c18e995d.js" defer></script><script src="/assets/js/28.ec4f1cef.js" defer></script>
  </body>
</html>
