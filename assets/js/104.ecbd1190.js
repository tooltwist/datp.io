(window.webpackJsonp=window.webpackJsonp||[]).push([[104],{623:function(e,t,a){"use strict";a.r(t);var o=a(60),s=Object(o.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"step-1-environment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#step-1-environment"}},[e._v("#")]),e._v(" Step 1 - Environment")]),e._v(" "),a("h3",{attrs:{id:"what-we-ll-be-creating"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-we-ll-be-creating"}},[e._v("#")]),e._v(" What we'll be creating")]),e._v(" "),a("p",[e._v('What we call an "environment", is a collection of AWS resources used to deploy one or more applications (in this case, DATP nodes).')]),e._v(" "),a("p",[e._v("Each environment is self contained, and protected from the outside world by various security measures.")]),e._v(" "),a("p",[e._v("Typically, you might have environments for each other following:")]),e._v(" "),a("ul",[a("li",[e._v("development")]),e._v(" "),a("li",[e._v("testing")]),e._v(" "),a("li",[e._v("staging")]),e._v(" "),a("li",[e._v("production")])]),e._v(" "),a("p",[e._v("The implementation of an environment described here, is an Amazon ECS Cluster running inside a Virtual Private Cloud, compartmentalised into separate subnets and security groups across multiple availability zones. The ECS Hosts and the services they run are not exposed to the public Internet, and can only be accessed\nvia one of jump boxes this environment sets up "),a("a",{attrs:{href:"https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("AWS Systems Manager Sessions Manager"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("p",[e._v("An environment does not provide a database by default, but it does provision the subnets and a security group for any databases (e.g. Aurora) or caches (e.g. REDIS) you will later add to the environment. In a non-production environment you will typically add one database instance, with internal databases assigned for each project you deploy in the environment.")]),e._v(" "),a("h3",{attrs:{id:"before-you-start"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#before-you-start"}},[e._v("#")]),e._v(" Before you start")]),e._v(" "),a("p",[e._v("Before you can begin, you will need to choose a name for your environment (not too long!) and also take note of the "),a("em",[a("strong",[e._v("prefix")])]),e._v(" you will use.")]),e._v(" "),a("p",[e._v("In a busy AWS account it can sometimes be difficult to know which person, or which tool, created each of the myriad resources.\nTo simplify identification, our scripts will prefix the name of each resource whenever possible. We update our Cloudformation scripts\noccasionally - these prefixes can also help you determine which environments and project you would like to upgrade.")]),e._v(" "),a("h3",{attrs:{id:"provisioning"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#provisioning"}},[e._v("#")]),e._v(" Provisioning")]),e._v(" "),a("p",[e._v("There are multiple stages of provisioning an environment, each utilising it's own Cloudformation template. These steps could be combined into a\nsingle Cloudformation template, but are kept separate to make it easy to customise a particular aspect of the set up. Feel free to download and\nmodify these templates to create your own customisation. Typical tweaks involve adjustments to use Fargate or other AWS features.")]),e._v(" "),a("p",[e._v("Go though the following steps. For each you will need to go to your "),a("a",{attrs:{href:"https://ap-southeast-1.console.aws.amazon.com/cloudformation/home?region=ap-southeast-1#/stacks",target:"_blank",rel:"noopener noreferrer"}},[e._v("Cloudformation"),a("OutboundLink")],1),e._v(" stacks page. Select "),a("code",[e._v("Create stack -> with new resources (standard)")]),e._v(". Copy in the URL of the template\nbelow and press "),a("em",[e._v("Next")]),e._v(" and enter the fields as discussed below.")]),e._v(" "),a("p",[e._v("After filling in the fields, skip through the remaining pages, where "),a("strong",[e._v("no input is required unless specifically mentioned")]),e._v(".")]),e._v(" "),a("h2",{attrs:{id:"_1-1-network"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-network"}},[e._v("#")]),e._v(" 1.1 - Network")]),e._v(" "),a("h4",{attrs:{id:"what-this-creates"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-this-creates"}},[e._v("#")]),e._v(" What this creates")]),e._v(" "),a("p",[e._v("1x Virtual Private Cloud (VPC)")]),e._v(" "),a("p",[e._v("1x Internet Gateway")]),e._v(" "),a("p",[e._v("2x Public subnets (One in each availability zone)")]),e._v(" "),a("p",[e._v("2x Private subnets (One in each availability zone)")]),e._v(" "),a("p",[e._v("2x NAT Gateways (One in each availability zone)")]),e._v(" "),a("p",[e._v("2x Route tables (One public, one private)")]),e._v(" "),a("p",[e._v("1x Load balancer security group")]),e._v(" "),a("p",[e._v("1x Application security group")]),e._v(" "),a("p",[e._v("1x Database security group")]),e._v(" "),a("p",[e._v("1x Database Subnet")]),e._v(" "),a("p",[e._v("1x Cache subnet (e.g. for REDIS), in case your application needs it")]),e._v(" "),a("h4",{attrs:{id:"template"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#template"}},[e._v("#")]),e._v(" Template")]),e._v(" "),a("p",[a("code",[e._v("https://s3-ap-southeast-1.amazonaws.com/tooltwist.aws-explorer.templates.2020-09-02/11.env-network.cf")])]),e._v(" "),a("p",[a("code",[e._v("2021-11-06/11.env-network.cf")])]),e._v(" "),a("h4",{attrs:{id:"fields"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fields"}},[e._v("#")]),e._v(" Fields")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Field")]),e._v(" "),a("th",[e._v("Description")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("Stack Name")]),e._v(" "),a("td",[e._v("EEEEEE-network  (e.g. 'dev-network')")])]),e._v(" "),a("tr",[a("td",[e._v("Contact Email")]),e._v(" "),a("td",[e._v("Who to call if there is a problem")])]),e._v(" "),a("tr",[a("td",[e._v("Cost Code")]),e._v(" "),a("td",[e._v("This can be used to identify resources for billing purposes")])]),e._v(" "),a("tr",[a("td",[e._v("Environment Name")]),e._v(" "),a("td",[e._v("EEEEEE")])]),e._v(" "),a("tr",[a("td",[e._v("Prefix")]),e._v(" "),a("td",[e._v("PPP- (e.g. 'dev-')")])])])]),e._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[e._v("Important !")]),e._v(" "),a("p",[e._v("Please "),a("strong",[e._v("write down the environment name and prefix")]),e._v(" you use, as they must be entered correctly and exactly the same in future steps.\nGetting them wrong will cause confusingly named, unusable resources to be created.")])]),e._v(" "),a("h2",{attrs:{id:"_1-2-jump-boxes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-jump-boxes"}},[e._v("#")]),e._v(" 1.2 - Jump Boxes")]),e._v(" "),a("p",[e._v("This creates one EC2 instance as a jump box, in the public subnets, in each of the availability zones.")]),e._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[e._v("NOTE: This step is now discouraged")]),e._v(" "),a("p",[e._v("Bastion Boxes (Jump boxes) are no longer recommended, since AWS enabled access to instances via SSM (see "),a("a",{attrs:{href:"https://www.youtube.com/watch?v=dhPtThh-ShI",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),a("OutboundLink")],1),e._v(" and "),a("a",{attrs:{href:"https://www.youtube.com/watch?v=-ASMtZBrx-k",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),a("OutboundLink")],1),e._v(" for an overview). However in rare circumstances you might want them, so we've left the template and instructions here.")])]),e._v(" "),a("h4",{attrs:{id:"cloudformation-template"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cloudformation-template"}},[e._v("#")]),e._v(" Cloudformation Template")]),e._v(" "),a("p",[a("code",[e._v("https://s3-ap-southeast-1.amazonaws.com/tooltwist.aws-explorer.templates.2020-04-01/12.env-jumpboxes.cf")])]),e._v(" "),a("p",[a("code",[e._v("2021-11-06/12.env-jumpboxes.cf")])]),e._v(" "),a("h4",{attrs:{id:"fields-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fields-2"}},[e._v("#")]),e._v(" Fields")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Field")]),e._v(" "),a("th",[e._v("Description")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("Stack Name")]),e._v(" "),a("td",[e._v("EEEEEE-jumpboxes  (e.g. 'dev-jumpboxes')")])]),e._v(" "),a("tr",[a("td",[e._v("Environment Name")]),e._v(" "),a("td",[e._v("EEEEEE")])]),e._v(" "),a("tr",[a("td",[e._v("Instance Type")]),e._v(" "),a("td",[e._v("t2.nano (It's only a jumpbox)")])]),e._v(" "),a("tr",[a("td",[e._v("Prefix")]),e._v(" "),a("td",[e._v("PPP- (e.g. 'v1-')")])])])]),e._v(" "),a("h2",{attrs:{id:"_1-3-keypair"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-keypair"}},[e._v("#")]),e._v(" 1.3 - Keypair")]),e._v(" "),a("p",[e._v("Before you create an environment in AWS, you will need a "),a("em",[a("strong",[e._v("keypair")])]),e._v(".")]),e._v(" "),a("p",[e._v("The keypair allows you to log into the AWS server instances you create. The following steps must be completed using the AWS Dashboard. You'll create the keypair, then download and install it on your machine. Don't lose this file, or you will not be able to login to the environment you create.")]),e._v(" "),a("p",[e._v("In the commands below replace the "),a("code",[e._v("ppp")]),e._v(" with your prefix (e.g. j-) and "),a("code",[e._v("eeeee")]),e._v(" below with your environment name.\nThis example is for Singapore (ap-southeast-1) but feel free to change\nthis to "),a("a",{attrs:{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#concepts-available-regions",target:"_blank",rel:"noopener noreferrer"}},[e._v("another AWS region"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("p",[e._v("a) Go to the "),a("a",{attrs:{href:"https://ap-southeast-1.console.aws.amazon.com/ec2/v2/home?region=ap-southeast-1#KeyPairs:sort=keyName",target:"_blank",rel:"noopener noreferrer"}},[e._v("Keypairs page of the AWS console"),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("b) Create a key pair with the RSA and .pem options selected, named "),a("code",[e._v("ppp-eeeee-region")]),e._v(". For example "),a("code",[e._v("j-dev-ap-southeast-1")]),e._v(" or "),a("code",[e._v("acme-prod-us-east-1")]),e._v(".")]),e._v(" "),a("p",[e._v("c) The keypair should be automatically downloaded to you machine, where you can install it:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("  $ mv ~/Downloads/ppp-eeeee-ap-southeast-1.pem ~/.ssh\n  $ chmod 600 ~/.ssh/ppp-eeeee-ap-southeast-1.pem\n")])])]),a("p",[e._v("d) On a Mac you'll need to remove the extended attributes.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("$ xattr -d com.apple.metadata:kMDItemWhereFroms ~/.ssh/ppp-eeeee-ap-southeast-1.pem\n$ xattr -d com.apple.quarantine ~/.ssh/ppp-eeeee-ap-southeast-1.pem\n")])])]),a("h2",{attrs:{id:"_1-4-ecs-cluster"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-ecs-cluster"}},[e._v("#")]),e._v(" 1.4 - ECS Cluster.")]),e._v(" "),a("p",[e._v("1x Role definition for the ECS services.")]),e._v(" "),a("p",[e._v("1x ECS Cluster")]),e._v(" "),a("p",[e._v("1x Autoscaling group")]),e._v(" "),a("p",[e._v("1x Launch Configuration")]),e._v(" "),a("h4",{attrs:{id:"cloudformation-template-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cloudformation-template-2"}},[e._v("#")]),e._v(" Cloudformation Template")]),e._v(" "),a("p",[a("code",[e._v("https://s3-ap-southeast-1.amazonaws.com/tooltwist.aws-explorer.templates.2021-05-10/12.env-ecs-cluster.cf")])]),e._v(" "),a("p",[a("code",[e._v("2021-11-06/13.env-ecs-cluster.cf")])]),e._v(" "),a("h4",{attrs:{id:"fields-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fields-3"}},[e._v("#")]),e._v(" Fields")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Field")]),e._v(" "),a("th",[e._v("Description")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("Stack Name")]),e._v(" "),a("td",[e._v("EEEEEE-cluster  (e.g. 'dev-cluster')")])]),e._v(" "),a("tr",[a("td",[e._v("Cluster size")]),e._v(" "),a("td",[e._v("How many EC2 instances do you want in the cluster? If unsure start with 1")])]),e._v(" "),a("tr",[a("td",[e._v("Environment Name")]),e._v(" "),a("td",[e._v("EEEEEE")])]),e._v(" "),a("tr",[a("td",[e._v("Instance Type")]),e._v(" "),a("td",[e._v("Choose an EC2 size appropriate for the environment's purpose")])]),e._v(" "),a("tr",[a("td",[e._v("Prefix")]),e._v(" "),a("td",[e._v("PPP- (e.g. 'v1-')")])])])]),e._v(" "),a("p",[e._v("On the final page, select "),a("em",[e._v("I acknowledge that AWS CloudFormation might create IAM resources")]),e._v(" and create the stack.")])])}),[],!1,null,null,null);t.default=s.exports}}]);