(window.webpackJsonp=window.webpackJsonp||[]).push([[235],{754:function(e,t,s){"use strict";s.r(t);var a=s(60),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"_12-webhook-replies"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_12-webhook-replies"}},[e._v("#")]),e._v(" 12 - Webhook Replies")]),e._v(" "),s("p",[e._v("When you specify a webhook url in the input of a transaction,\nDATP will use that URL to contact the client any time the\nstatus of the transaction changes.")]),e._v(" "),s("p",[e._v("On the client side it requires more coding than simply\npolling to get the status, but it has several advantages:")]),e._v(" "),s("ol",[s("li",[s("p",[e._v("The reply is guaranteed, even if there is a network failure\nor the client system goes down - DATP will just keep trying (with an exponential backoff) until it succeeds.")])]),e._v(" "),s("li",[s("p",[e._v("Simplified client code, because it does not need to poll - it can start the transaction and then move on - it does not need to poll.")])])]),e._v(" "),s("p",[e._v("Webhook replies are cryptographically signed.")]),e._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("Note")]),e._v(" "),s("p",[e._v("While it is possible to read a reply without checking the signature\nwe strongly recommend that you do,\nto ensure that nobody has tampering with the reply,\nand nobody is sending fake replies to your client application.")])]),e._v(" "),s("p",[e._v("See the "),s("a",{attrs:{href:"http://datp.io/guide/DZDwebhooks.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Webhooks documentation"),s("OutboundLink")],1),e._v(" for details on how signatures can be checked.")]),e._v(" "),s("h2",{attrs:{id:"a-mock-webhook-server"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#a-mock-webhook-server"}},[e._v("#")]),e._v(" A Mock webhook server")]),e._v(" "),s("p",[e._v("While you are developing it may be useful to simulate a client\nthat will receive a webhook replies.")]),e._v(" "),s("p",[e._v("In VSCode, copy the entire folder "),s("code",[e._v("COURSE-FILES/2.12-webhooks/server-for-webhooks")]),e._v(" into the top level of your workspace (same level as myProject, but not inside myProject).")]),e._v(" "),s("p",[e._v("Open a new terminal inside VSCode (control-shift-backtick) and run\nthe following:")]),e._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" /workspace/server-for-webhooks\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("yarn")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("yarn")]),e._v(" dev\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("p",[e._v("The mock server will start and tell you the URL you can use for webhooks.")]),e._v(" "),s("blockquote",[s("p",[e._v("Send webhook replies to http://localhost:33340/notify")])]),e._v(" "),s("p",[e._v("Go to the MONDAT test page and choose the null test,\nand set this URL in the input.")]),e._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"metadata"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"reply"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"longpoll"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"webhook"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"http://localhost:33340/notify"')]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"data"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"afield"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"xyz"')]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br")])]),s("p",[e._v("Run your test, and you will see the transaction status sent to the\nmock server.")]),e._v(" "),s("h2",{attrs:{id:"guaranteed-delivery"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#guaranteed-delivery"}},[e._v("#")]),e._v(" Guaranteed delivery")]),e._v(" "),s("p",[e._v("We can simulate a client system that calls our application to\nstart a transaction, but which goes down before the transaction completes:")]),e._v(" "),s("ol",[s("li",[e._v("Try running the test with the mock server "),s("em",[e._v("not")]),e._v(" running.")]),e._v(" "),s("li",[e._v("Look at the webhook status in the Cache/Archive screen and you will see the webhook scheduled for retry.")]),e._v(" "),s("li",[e._v("Press refresh and see the "),s("em",[e._v("Attempts")]),e._v(" increasing.")]),e._v(" "),s("li",[e._v("Start the mock server, and you'll see it receive the reply, and if\nyou refresh MONDAT the webhook status will now be "),s("em",[e._v("Not scheduled")]),e._v(".")])])])}),[],!1,null,null,null);t.default=n.exports}}]);